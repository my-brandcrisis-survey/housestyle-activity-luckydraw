<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½çæ¸¬è©¦ç‰ˆ - å°–ç«¯æœä¸Š</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            width: 90%;
            max-width: 450px;
        }

        h1 { color: #ff6600; margin: 0; font-size: 28px; }
        .subtitle { color: #666; margin: 10px 0 30px; font-size: 16px; }

        .wheel-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 0 auto 30px;
        }

        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transform: rotate(-90deg); /* åˆå§‹æ—‹è½‰ä¿®æ­£ */
        }

        /* ä¿®æ­£å¾Œçš„æŒ‡é‡ï¼šå°–ç«¯æœä¸Š */
        .pointer-box {
            position: absolute;
            top: 50%;
            left: 50%;
            /* rotate(0deg) é…åˆä¸‹æ–¹ path èª¿æ•´ï¼Œç¢ºä¿å°–ç«¯æœä¸Š */
            transform: translate(-50%, -50%) rotate(0deg); 
            width: 50px;
            height: 50px;
            z-index: 10;
        }

        .pointer-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 -2px 5px rgba(0,0,0,0.2));
        }

        button {
            background: #ff6600;
            color: white;
            border: none;
            padding: 12px 60px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(255, 102, 0, 0.3);
        }

        button:hover { background: #e65c00; transform: scale(1.05); }
        button:disabled { background: #ccc; cursor: not-allowed; }

        #result {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            min-height: 24px;
        }
        .test-mode {
            margin-top: 10px;
            font-size: 12px;
            color: #e74c3c;
        }
    </style>
</head>
<body>

<div class="card">
    <h1>ğŸ¡ å¹¸é‹å¤§è½‰ç›¤</h1>
    <p class="subtitle">å–®ç­†æ¶ˆè²»æ»¿ $8,888 å³å¯å•Ÿå‹•</p>

    <div class="wheel-container">
        <div class="pointer-box">
            <svg class="pointer-svg" viewBox="0 0 100 100">
                <path d="M50 0 L85 55 C85 75 70 100 50 100 C30 100 15 75 15 55 Z" fill="#3b5998" stroke="#ffd700" stroke-width="4"/>
                <circle cx="50" cy="65" r="12" fill="#ffd700"/>
            </svg>
        </div>
        <canvas id="wheel" width="600" height="600"></canvas>
    </div>

    <button id="spinBtn">é–‹å§‹æŠ½ç</button>
    <div id="result"></div>
    <p class="test-mode">âš ï¸ ç›®å‰ç‚ºæ¸¬è©¦æ¨¡å¼ï¼šé‡æ–°æ•´ç†ç¶²é å³å¯å†æ¬¡æŠ½ç</p>
</div>

<script>
    // ã€æ¸¬è©¦æ¨¡å¼é—œéµã€‘æ¯æ¬¡é‡æ–°æ•´ç†ç¶²é éƒ½æ¸…é™¤ç´€éŒ„
    localStorage.removeItem('myResult');

    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const spinBtn = document.getElementById('spinBtn');
    const resultDiv = document.getElementById('result');

    const prizes = [
        { name: 'Aè³: 8æŠ˜', weight: 1, color: '#ff6600' },
        { name: 'Bè³: é…ä»¶', weight: 6, color: '#ffffff' },
        { name: 'Cè³: æ¸…æ½”åŠ‘', weight: 10, color: '#ff6600' },
        { name: 'Dè³: 9æŠ˜', weight: 23, color: '#ffffff' },
        { name: 'Eè³: è¡›ç”Ÿç´™å¥—', weight: 60, color: '#ff6600' }
    ];

    const totalWeight = prizes.reduce((sum, p) => sum + p.weight, 0);
    let isSpinning = false;

    function drawWheel() {
        const numPrizes = prizes.length;
        const arc = (Math.PI * 2) / numPrizes;

        prizes.forEach((p, i) => {
            const angle = i * arc;
            ctx.beginPath();
            ctx.fillStyle = p.color;
            ctx.moveTo(300, 300);
            ctx.arc(300, 300, 300, angle, angle + arc);
            ctx.fill();
            ctx.strokeStyle = "#ddd";
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.save();
            ctx.translate(300, 300);
            ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = (p.color === '#ffffff') ? '#ff6600' : '#ffffff';
            ctx.font = "bold 40px Microsoft JhengHei";
            ctx.fillText(p.name.split(':')[0], 250, 15);
            ctx.restore();
        });
    }

    function getWeightedResult() {
        let random = Math.random() * totalWeight;
        for (let i = 0; i < prizes.length; i++) {
            if (random < prizes[i].weight) return i;
            random -= prizes[i].weight;
        }
        return prizes.length - 1;
    }

    spinBtn.onclick = () => {
        if (isSpinning) return;
        isSpinning = true;
        spinBtn.disabled = true;
        
        const prizeIndex = getWeightedResult();
        const segmentDeg = 360 / prizes.length;
        
        // æ—‹è½‰è¨ˆç®—ï¼šå› ç‚ºæŒ‡é‡åœ¨ä¸­é–“å°–ç«¯æœä¸Šï¼Œå®ƒå°æ‡‰çš„æ˜¯è½‰ç›¤ã€Œæ­£ä¸‹æ–¹ã€çš„çé …
        // æ‰€ä»¥æˆ‘å€‘è¦å¤šè½‰ 180 åº¦ä¾†è£œå„Ÿå°é½Š
        const rotation = 3600 + (360 - (prizeIndex * segmentDeg)) - (segmentDeg / 2) + 180;

        canvas.style.transition = "transform 5s cubic-bezier(0.15, 0, 0.15, 1)";
        canvas.style.transform = `rotate(${rotation - 90}deg)`;

        setTimeout(() => {
            const winner = prizes[prizeIndex].name;
            resultDiv.innerHTML = `ğŸ‰ æ­å–œä¸­çï¼š<span style="color:#ff6600">${winner}</span>`;
            alert(`æ­å–œæ‚¨æŠ½ä¸­ï¼š${winner}ï¼`);
            isSpinning = false;
            spinBtn.disabled = false; // æ¸¬è©¦æ¨¡å¼ä¸‹æŠ½å®Œå¾Œæ¢å¾©æŒ‰éˆ•
        }, 5200);
    };

    drawWheel();
</script>

</body>
</html>
