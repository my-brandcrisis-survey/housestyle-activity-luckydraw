<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥½æ™‚ä»£è¡›æµ´ æ–°æ˜¥æ´»å‹•å¹¸é‹å¤§è½‰ç›¤ - æ»¿é¡8888å³å¯æŠ½çä¸€æ¬¡</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            width: 90%;
            max-width: 450px;
        }

        /* æ¨™é¡Œæ¨£å¼èª¿æ•´ */
        .title-line1 {
            color: #1e90ff;
            font-size: 28px;
            font-weight: bold;
            margin: 0;
            display: block;
        }
        .title-line2 {
            color: #1e90ff;
            font-size: 28px;
            font-weight: bold;
            margin: 5px 0 0 0;
            display: block;
        }
        .subtitle { color: #666; margin: 10px 0 30px; font-size: 16px; }

        .wheel-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 0 auto 30px;
        }

        /* ç•«å¸ƒ */
        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transform: rotate(-90deg); /* è®“ç¬¬ä¸€å€‹çé …å¾æ­£ä¸Šæ–¹é–‹å§‹è¨ˆç®— */
        }

        /* æ°´æ»´å½¢æŒ‡é‡ */
        .pointer-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(180deg); 
            width: 50px;
            height: 50px;
            z-index: 10;
        }

        .pointer-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.2));
        }

        button {
            background: #ff6600;
            color: white;
            border: none;
            padding: 12px 60px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(255, 102, 0, 0.3);
        }

        button:hover { background: #e65c00; transform: scale(1.05); }
        button:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; transform: none; }

        #result {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            min-height: 24px;
        }
        .test-mode {
            margin-top: 10px;
            font-size: 12px;
            color: #e74c3c;
        }
    </style>
</head>
<body>

<div class="card">
    <span class="title-line1">å¥½æ™‚ä»£è¡›æµ´</span>
    <span class="title-line2">æ–°æ˜¥æ´»å‹•å¹¸é‹å¤§è½‰ç›¤</span>
    <p class="subtitle">å–®ç­†æ¶ˆè²»æ»¿ $8,888 å³å¯å•Ÿå‹•å¹¸é‹è¼ªç›¤</p>

    <div class="wheel-container">
        <div class="pointer-box">
            <svg class="pointer-svg" viewBox="0 0 100 100">
                <path d="M50 0 C30 0 15 25 15 45 C15 70 50 100 50 100 C50 100 85 70 85 45 C85 25 70 0 50 0 Z" fill="#3b5998" stroke="#ffd700" stroke-width="4"/>
                <circle cx="50" cy="40" r="12" fill="#ffd700"/>
            </svg>
        </div>
        <canvas id="wheel" width="600" height="600"></canvas>
    </div>

    <button id="spinBtn">é–‹å§‹æŠ½ç</button>
    <div id="result"></div>
    <p class="test-mode">âš ï¸ ç›®å‰ç‚ºæ¸¬è©¦æ¨¡å¼ï¼šé‡æ–°æ•´ç†ç¶²é å³å¯å†æ¬¡æŠ½ç</p>
</div>

<script>
    // æ¸¬è©¦æ¨¡å¼ä¸‹è‡ªå‹•æ¸…é™¤ç´€éŒ„
    localStorage.removeItem('myResult');

    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const spinBtn = document.getElementById('spinBtn');
    const resultDiv = document.getElementById('result');

    // 1. è¨­å®šçé …ã€é¡è‰²èˆ‡æ©Ÿç‡ (Weight)
    const prizes = [
        { name: 'Aè³: å–®ç­†é‡‘é¡äº«8æŠ˜å„ªæƒ ', weight: 1, color: '#ff6600' },
        { name: 'Bè³: ç²å¾—æŒ‡å®šé…ä»¶ä¹™å€‹', weight: 6, color: '#ffffff' },
        { name: 'Cè³: ç²å¾—GROHEæ¸…æ½”åŠ‘ä¹™å€‹', weight: 10, color: '#ff6600' },
        { name: 'Dè³: å–®ç­†é‡‘é¡äº«9æŠ˜å„ªæƒ ', weight: 23, color: '#ffffff' },
        { name: 'Eè³: ç²å¾—è¡›ç”Ÿç´™å¥—ä¹™å€‹', weight: 60, color: '#ff6600' }
    ];

    const totalWeight = prizes.reduce((sum, p) => sum + p.weight, 0);
    let isSpinning = false;

    // æª¢æŸ¥æ˜¯å¦æŠ½é
    const savedPrize = localStorage.getItem('myResult');
    if (savedPrize) {
        spinBtn.disabled = true;
        resultDiv.innerHTML = `æ‚¨å·²åƒåŠ éæŠ½çï¼Œç²å¾—ï¼š<span style="color:#ff6600">${savedPrize}</span>`;
    }

    // 2. ç¹ªè£½è½‰ç›¤å‡½æ•¸
    function drawWheel() {
        const numPrizes = prizes.length;
        const arc = (Math.PI * 2) / numPrizes;

        prizes.forEach((p, i) => {
            const angle = i * arc;
            
            // ç•«æ‰‡å½¢
            ctx.beginPath();
            ctx.fillStyle = p.color;
            ctx.moveTo(300, 300);
            ctx.arc(300, 300, 300, angle, angle + arc);
            ctx.fill();
            ctx.strokeStyle = "#ddd";
            ctx.lineWidth = 2;
            ctx.stroke();

            // ç•«æ–‡å­—
            ctx.save();
            ctx.translate(300, 300);
            ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = (p.color === '#ffffff') ? '#ff6600' : '#ffffff';
            ctx.font = "bold 40px Microsoft JhengHei";
            ctx.fillText(p.name.split(':')[0], 250, 15); // é¡¯ç¤º Aè³, Bè³...
            ctx.restore();
        });
    }

    // 3. æ ¹æ“šæ©Ÿç‡è¨ˆç®—çµæœ
    function getWeightedResult() {
        let random = Math.random() * totalWeight;
        for (let i = 0; i < prizes.length; i++) {
            if (random < prizes[i].weight) return i;
            random -= prizes[i].weight;
        }
        return prizes.length - 1;
    }

    // 4. æŠ½çå‹•ä½œ
    spinBtn.onclick = () => {
        if (isSpinning || localStorage.getItem('myResult')) return;

        isSpinning = true;
        spinBtn.disabled = true;
        
        const prizeIndex = getWeightedResult();
        const segmentDeg = 360 / prizes.length;
        
        // è¨ˆç®—æ—‹è½‰åº¦æ•¸ (è‡³å°‘è½‰5åœˆ + æŠ½ä¸­çé …çš„è§’åº¦)
        // æ¸›å» segmentDeg/2 æ˜¯ç‚ºäº†è®“æŒ‡é‡åœåœ¨æ‰‡å½¢æ­£ä¸­é–“
        const rotation = 3600 + (360 - (prizeIndex * segmentDeg)) - (segmentDeg / 2);

        canvas.style.transition = "transform 5s cubic-bezier(0.15, 0, 0.15, 1)";
        canvas.style.transform = `rotate(${rotation - 90}deg)`; // -90åº¦æ˜¯ä¿®æ­£åˆå§‹ç¹ªè£½åç§»

        setTimeout(() => {
            const winner = prizes[prizeIndex].name;
            resultDiv.innerHTML = `ğŸ‰ æ­å–œä¸­çï¼š<span style="color:#ff6600">${winner}</span>`;
            localStorage.setItem('myResult', winner);
            alert(`æ­å–œæ‚¨æŠ½ä¸­ï¼š${winner}ï¼\nè«‹æˆªåœ–å‘ŠçŸ¥åº—å“¡ã€‚`);
            isSpinning = false;
        }, 5200);
    };

    drawWheel();
</script>

</body>
</html>
